<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>à¹à¸­à¸›à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨</title>
    <style>
        /* --- à¹€à¸à¸´à¹ˆà¸¡ CSS Variables à¸ªà¸³à¸«à¸£à¸±à¸š Dark/Light Mode --- */
        :root {
            --bg-color: #f4f7f9;
            --text-color: #333;
            --container-bg: #ffffff;
            --box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
            --border-color: #e0e0e0;
            --input-bg: #ffffff;
            --input-border: #ccc;
            --item-bg: #f9f9f9;
            --header-h1-color: #333;
            --status-normal-color: #f39c12;
            --status-low-color: #c0392b;
            --status-high-color: #27ae60;
            --icon-color: #2c3e50;
            --pressure-low-color: #2980b9;
            --pressure-high-color: #c0392b;
            --link-color: #3498db;
        }

        body.dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --container-bg: #1e1e1e;
            --box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            --border-color: #333;
            --input-bg: #2e2e2e;
            --input-border: #444;
            --item-bg: #2e2e2e;
            --header-h1-color: #f0f0f0;
            --status-normal-color: #f1c40f;
            --status-low-color: #e74c3c;
            --status-high-color: #2ecc71;
            --icon-color: #ffffff;
            --pressure-low-color: #5d9cec;
            --pressure-high-color: #e74c3c;
            --link-color: #5d9cec;
        }
        /* --- à¸ˆà¸šà¸ªà¹ˆà¸§à¸™ CSS Variables --- */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s, color 0.3s;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--box-shadow);
            border: 1px solid var(--border-color);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            color: var(--header-h1-color);
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .cors-notice {
            margin: 10px 0;
            padding: 15px;
            background: rgba(255, 229, 100, 0.3);
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-radius: 10px;
            color: #555;
            font-size: 0.9em;
            text-align: center;
        }
        body.dark-mode .cors-notice {
            background: rgba(255, 229, 100, 0.15);
            border-color: rgba(255, 193, 7, 0.2);
            color: #ccc;
        }
        .cors-notice a {
            color: #d68910;
            text-decoration: none;
            font-weight: bold;
        }
        .cors-notice a:hover {
            text-decoration: underline;
        }
        .location-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center; /* à¸ˆà¸±à¸”à¹ƒà¸«à¹‰à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¹à¸™à¸§à¹€à¸”à¸µà¸¢à¸§à¸à¸±à¸™ */
        }
        .location-input input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid var(--input-border);
            border-radius: 10px;
            background: var(--input-bg);
            color: var(--text-color);
            transition: background-color 0.3s, border-color 0.3s;
        }
        .location-input input::placeholder {
            color: #999;
        }
        body.dark-mode .location-input input::placeholder {
            color: #888;
        }
        .location-input button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: #3498db;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }
        .location-input button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* --- à¹‚à¸„à¹‰à¸”à¹ƒà¸«à¸¡à¹ˆà¸—à¸µà¹ˆà¹€à¸à¸´à¹ˆà¸¡à¹€à¸‚à¹‰à¸²à¸¡à¸² --- */
        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .toggle-container {
            display: flex;
            align-items: center;
        }
        .toggle-button, .lang-button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            padding: 5px;
            border-radius: 5px;
            transition: transform 0.2s;
        }
        .lang-button {
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .lang-button:hover {
            opacity: 0.8;
        }
        .lang-button.active {
            opacity: 1;
            border: 1px solid var(--link-color);
            padding: 4px;
        }
        .lang-icons {
            display: flex;
            gap: 5px;
        }
        .about-link {
            display: block;
            margin-top: 15px;
            color: var(--link-color);
            text-decoration: none;
            font-size: 0.9em;
            text-align: center;
        }
        .about-link:hover {
            text-decoration: underline;
        }
        /* --- à¸ˆà¸šà¸ªà¹ˆà¸§à¸™à¹‚à¸„à¹‰à¸”à¹ƒà¸«à¸¡à¹ˆ --- */

        .current-pressure {
            background: var(--item-bg);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        .current-pressure h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        .pressure-value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            color: var(--icon-color);
            transition: color 0.3s;
        }
        .pressure-unit {
            font-size: 1.2em;
            opacity: 0.8;
        }
        .forecast-section {
            background: var(--container-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s, color 0.3s;
        }
        .forecast-section h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }
        .hourly-forecast, .daily-forecast {
            display: grid;
            gap: 15px;
            margin-bottom: 10px;
        }
        .hourly-forecast {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }
        .daily-forecast {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }
        .hourly-item, .daily-item {
            background: var(--item-bg);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            border: 1px solid var(--border-color);
        }
        .hourly-item:hover, .daily-item:hover {
            transform: translateY(-5px);
            background: var(--container-bg);
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        body.dark-mode .hourly-item:hover, body.dark-mode .daily-item:hover {
             box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .day-name {
            font-weight: bold;
            margin-bottom: 8px;
        }
        .high-low {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
        }
        .loading {
            text-align: center;
            color: var(--text-color);
            font-size: 1.2em;
            padding: 40px;
        }
        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0,0,0,0.1);
            border-radius: 50%;
            border-top-color: var(--text-color);
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
            transition: border-top-color 0.3s;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: #D8000C;
            text-align: center;
            margin: 10px 0;
        }
        body.dark-mode .error {
            background: rgba(255, 0, 0, 0.1);
            border-color: rgba(255, 0, 0, 0.2);
            color: #ffb3b3;
        }
        .current-location {
            color: #555;
            text-align: center;
            margin-bottom: 10px;
            transition: color 0.3s;
        }
        body.dark-mode .current-location {
            color: #aaa;
        }
        .status-good { color: var(--status-high-color); }
        .status-warning { color: var(--status-normal-color); }
        .status-danger { color: var(--status-low-color); }
        
        .high-low .high-pressure { color: var(--pressure-high-color); }
        .high-low .low-pressure { color: var(--pressure-low-color); }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .header h1 {
                font-size: 2em;
            }
            .pressure-value {
                font-size: 2.5em;
            }
            .location-input {
                flex-direction: column;
            }
            .location-input input, .location-input button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-top">
                <div class="lang-icons">
                    <button class="lang-button" data-lang="th">ğŸ‡¹ğŸ‡­</button>
                    <button class="lang-button" data-lang="en">ğŸ‡¬ğŸ‡§</button>
                    <button class="lang-button" data-lang="ja">ğŸ‡¯ğŸ‡µ</button>
                    <button class="lang-button" data-lang="zh">ğŸ‡¨ğŸ‡³</button>
                    <button class="lang-button" data-lang="es">ğŸ‡ªğŸ‡¸</button>
                </div>
                <div class="toggle-container">
                    <button id="themeToggle" class="toggle-button" onclick="toggleDarkMode()">
                        <span id="themeIcon">ğŸŒ™</span>
                    </button>
                </div>
            </div>
            
            <h1 id="app-title">â›ˆï¸ à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨</h1>
            
            <div class="cors-notice">
                <span id="cors-important">ğŸ’¡ <strong>à¸ªà¸³à¸„à¸±à¸:</strong></span> <span id="cors-message">à¸«à¸²à¸à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¹„à¸›à¸—à¸µà¹ˆ</span>
                <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">cors-anywhere.herokuapp.com/corsdemo</a>
                <span id="cors-instruction">à¹à¸¥à¸°à¸à¸”à¸›à¸¸à¹ˆà¸¡ "Request temporary access" à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™</span>
            </div>
            
            <div class="location-input">
                <input type="text" id="locationInput" placeholder="à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¹€à¸¡à¸·à¸­à¸‡ (à¹€à¸Šà¹ˆà¸™ Bangkok, London, Tokyo)">
                <button id="search-button" onclick="searchWeather()">ğŸ” à¸„à¹‰à¸™à¸«à¸²</button>
                <button id="current-location-button" onclick="getCurrentLocation()">ğŸ“ à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™</button>
            </div>
            <div class="current-location" id="currentLocation"></div>
            
            <a href="about.html" class="about-link" id="about-link">à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™</a>
        </div>

        <div id="loading" class="loading" style="display: none;">
            à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...
        </div>
        <div id="error" class="error" style="display: none;"></div>
        <div id="weatherData" style="display: none;">
            <div class="current-pressure">
                <h2 id="current-pressure-title">à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨ à¸“ à¸‚à¸“à¸°à¸™à¸µà¹‰</h2>
                <div class="pressure-value" id="currentPressure">-</div>
                <div class="pressure-unit">hPa</div>
                <div id="pressureStatus" style="margin-top: 10px; font-weight: bold;"></div>
                <div style="margin-top: 15px; opacity: 0.9; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                    <div>ğŸŒ¡ï¸ <span id="currentTemp">-</span>Â°C</div>
                    <div>ğŸ’§ <span id="currentHumidity">-</span>%</div>
                    <div>ğŸ’¨ <span id="currentWind">-</span> km/h</div>
                </div>
            </div>
            <div class="forecast-section">
                <h3 id="hourly-forecast-title">â° à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸£à¸²à¸¢à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ (24 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²)</h3>
                <div class="hourly-forecast" id="hourlyForecast"></div>
            </div>
            <div class="forecast-section">
                <h3 id="daily-forecast-title">ğŸ“… à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸£à¸²à¸¢à¸§à¸±à¸™ (5 à¸§à¸±à¸™à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²)</h3>
                <div class="daily-forecast" id="dailyForecast"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '511d57e91a9ca60a44bd189d78dfe9af';
        const API_BASE = 'https://api.openweathermap.org/data/2.5';
        const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/';
        const langData = {
            th: {
                title: 'â›ˆï¸ à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨',
                corsImportant: 'ğŸ’¡ <strong>à¸ªà¸³à¸„à¸±à¸:</strong>',
                corsMessage: 'à¸«à¸²à¸à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¹„à¸›à¸—à¸µà¹ˆ',
                corsInstruction: 'à¹à¸¥à¸°à¸à¸”à¸›à¸¸à¹ˆà¸¡ "Request temporary access" à¸à¹ˆà¸­à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™',
                inputPlaceholder: 'à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¹€à¸¡à¸·à¸­à¸‡ (à¹€à¸Šà¹ˆà¸™ Bangkok, London, Tokyo)',
                searchButton: 'ğŸ” à¸„à¹‰à¸™à¸«à¸²',
                currentLocationButton: 'ğŸ“ à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸›à¸±à¸ˆà¸ˆà¸¸à¸šà¸±à¸™',
                aboutLink: 'à¹€à¸à¸µà¹ˆà¸¢à¸§à¸à¸±à¸šà¹à¸­à¸›à¸à¸¥à¸´à¹€à¸„à¸Šà¸±à¸™',
                loading: 'à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥...',
                errorNoLocation: 'à¸à¸£à¸¸à¸“à¸²à¹ƒà¸ªà¹ˆà¸Šà¸·à¹ˆà¸­à¹€à¸¡à¸·à¸­à¸‡',
                errorFetch: 'à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸”à¸¶à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰ à¸à¸£à¸¸à¸“à¸²à¹€à¸›à¸´à¸”à¹ƒà¸Šà¹‰à¸‡à¸²à¸™ CORS proxy à¸•à¸²à¸¡à¸„à¸³à¹à¸™à¸°à¸™à¸³à¸”à¹‰à¸²à¸™à¸šà¸™',
                errorNotFound: 'à¹„à¸¡à¹ˆà¸à¸šà¹€à¸¡à¸·à¸­à¸‡à¸—à¸µà¹ˆà¸£à¸°à¸šà¸¸ à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸à¸²à¸£à¸ªà¸°à¸à¸”à¸Šà¸·à¹ˆà¸­à¹€à¸¡à¸·à¸­à¸‡',
                errorGeolocation: 'à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œà¸‚à¸­à¸‡à¸„à¸¸à¸“à¹„à¸¡à¹ˆà¸£à¸­à¸‡à¸£à¸±à¸šà¸à¸²à¸£à¸£à¸°à¸šà¸¸à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡',
                errorPermissionDenied: 'à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¸–à¸¹à¸à¸›à¸à¸´à¹€à¸ªà¸˜ à¸à¸£à¸¸à¸“à¸²à¸­à¸™à¸¸à¸à¸²à¸•à¸à¸²à¸£à¹€à¸‚à¹‰à¸²à¸–à¸¶à¸‡à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹ƒà¸™à¹€à¸šà¸£à¸²à¸§à¹Œà¹€à¸‹à¸­à¸£à¹Œ',
                errorUnavailable: 'à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡à¹„à¸¡à¹ˆà¸à¸£à¹‰à¸­à¸¡à¹ƒà¸Šà¹‰à¸‡à¸²à¸™',
                errorTimeout: 'à¸«à¸¡à¸”à¹€à¸§à¸¥à¸²à¹ƒà¸™à¸à¸²à¸£à¸„à¹‰à¸™à¸«à¸²à¸•à¸³à¹à¸«à¸™à¹ˆà¸‡ à¸à¸£à¸¸à¸“à¸²à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆ',
                currentPressureTitle: 'à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨ à¸“ à¸‚à¸“à¸°à¸™à¸µà¹‰',
                statusHigh: 'ğŸ”º à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨à¸ªà¸¹à¸‡',
                statusNormal: 'â¡ï¸ à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨à¸›à¸à¸•à¸´',
                statusLow: 'ğŸ”» à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨à¸•à¹ˆà¸³',
                hourlyTitle: 'â° à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸£à¸²à¸¢à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡ (24 à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²)',
                dailyTitle: 'ğŸ“… à¸à¸¢à¸²à¸à¸£à¸“à¹Œà¸£à¸²à¸¢à¸§à¸±à¸™ (5 à¸§à¸±à¸™à¸‚à¹‰à¸²à¸‡à¸«à¸™à¹‰à¸²)',
                today: 'à¸§à¸±à¸™à¸™à¸µà¹‰',
                tomorrow: 'à¸à¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰',
                dayNames: ['à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ', 'à¸ˆà¸±à¸™à¸—à¸£à¹Œ', 'à¸­à¸±à¸‡à¸„à¸²à¸£', 'à¸à¸¸à¸˜', 'à¸à¸¤à¸«à¸±à¸ªà¸šà¸”à¸µ', 'à¸¨à¸¸à¸à¸£à¹Œ', 'à¹€à¸ªà¸²à¸£à¹Œ'],
                pressureLabel: 'à¸„à¸§à¸²à¸¡à¸à¸”à¸­à¸²à¸à¸²à¸¨',
            },
            en: {
                title: 'â›ˆï¸ Air Pressure Forecast',
                corsImportant: 'ğŸ’¡ <strong>Important:</strong>',
                corsMessage: 'If data fails to load, please visit',
                corsInstruction: 'and click "Request temporary access" before use.',
                inputPlaceholder: 'Enter city name (e.g., Bangkok, London, Tokyo)',
                searchButton: 'ğŸ” Search',
                currentLocationButton: 'ğŸ“ Current Location',
                aboutLink: 'About Application',
                loading: 'Loading data...',
                errorNoLocation: 'Please enter a city name',
                errorFetch: 'Could not fetch data. Please enable the CORS proxy as instructed above.',
                errorNotFound: 'City not found. Please check spelling.',
                errorGeolocation: 'Your browser does not support geolocation.',
                errorPermissionDenied: 'Location access denied. Please allow access in your browser.',
                errorUnavailable: 'Location information is unavailable.',
                errorTimeout: 'The request to get user location timed out.',
                currentPressureTitle: 'Current Air Pressure',
                statusHigh: 'ğŸ”º High Pressure',
                statusNormal: 'â¡ï¸ Normal Pressure',
                statusLow: 'ğŸ”» Low Pressure',
                hourlyTitle: 'â° Hourly Forecast (24h)',
                dailyTitle: 'ğŸ“… Daily Forecast (5 Days)',
                today: 'Today',
                tomorrow: 'Tomorrow',
                dayNames: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                pressureLabel: 'Air Pressure',
            },
            ja: {
                title: 'â›ˆï¸ æ°—åœ§äºˆå ±',
                corsImportant: 'ğŸ’¡ <strong>é‡è¦:</strong>',
                corsMessage: 'ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ãŸå ´åˆã¯ã€',
                corsInstruction: 'ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã€"Request temporary access" ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚',
                inputPlaceholder: 'éƒ½å¸‚åã‚’å…¥åŠ› (ä¾‹: Bangkok, London, Tokyo)',
                searchButton: 'ğŸ” æ¤œç´¢',
                currentLocationButton: 'ğŸ“ ç¾åœ¨åœ°',
                aboutLink: 'ã‚¢ãƒ—ãƒªã«ã¤ã„ã¦',
                loading: 'ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...',
                errorNoLocation: 'éƒ½å¸‚åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„',
                errorFetch: 'ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã›ã‚“ã€‚ä¸Šè¨˜ã®CORSãƒ—ãƒ­ã‚­ã‚·ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„',
                errorNotFound: 'éƒ½å¸‚ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¹ãƒšãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„',
                errorGeolocation: 'ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ä½ç½®æƒ…å ±ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“',
                errorPermissionDenied: 'ä½ç½®æƒ…å ±ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒæ‹’å¦ã•ã‚Œã¾ã—ãŸã€‚ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ãã ã•ã„',
                errorUnavailable: 'ä½ç½®æƒ…å ±ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“',
                errorTimeout: 'ä½ç½®æƒ…å ±ã®æ¤œç´¢ãŒã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ',
                currentPressureTitle: 'ç¾åœ¨ã®æ°—åœ§',
                statusHigh: 'ğŸ”º é«˜æ°—åœ§',
                statusNormal: 'â¡ï¸ é€šå¸¸ã®æ°—åœ§',
                statusLow: 'ğŸ”» ä½æ°—åœ§',
                hourlyTitle: 'â° æ™‚é–“åˆ¥äºˆå ± (24æ™‚é–“)',
                dailyTitle: 'ğŸ“… æ—¥åˆ¥äºˆå ± (5æ—¥é–“)',
                today: 'ä»Šæ—¥',
                tomorrow: 'æ˜æ—¥',
                dayNames: ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'],
                pressureLabel: 'æ°—åœ§',
            },
            zh: {
                title: 'â›ˆï¸ æ°”å‹é¢„æŠ¥',
                corsImportant: 'ğŸ’¡ <strong>é‡è¦æç¤º:</strong>',
                corsMessage: 'å¦‚æœæ•°æ®åŠ è½½å¤±è´¥ï¼Œè¯·è®¿é—®',
                corsInstruction: 'å¹¶ç‚¹å‡»â€œRequest temporary accessâ€æŒ‰é’®ï¼Œç„¶åé‡è¯•ã€‚',
                inputPlaceholder: 'è¾“å…¥åŸå¸‚åç§° (ä¾‹å¦‚: Bangkok, London, Tokyo)',
                searchButton: 'ğŸ” æœç´¢',
                currentLocationButton: 'ğŸ“ å½“å‰ä½ç½®',
                aboutLink: 'å…³äºåº”ç”¨ç¨‹åº',
                loading: 'æ­£åœ¨åŠ è½½æ•°æ®...',
                errorNoLocation: 'è¯·è¾“å…¥åŸå¸‚åç§°',
                errorFetch: 'æ— æ³•è·å–æ•°æ®ã€‚è¯·æŒ‰ç…§ä¸Šè¿°è¯´æ˜å¯ç”¨CORSä»£ç†',
                errorNotFound: 'æœªæ‰¾åˆ°è¯¥åŸå¸‚ã€‚è¯·æ£€æŸ¥æ‹¼å†™',
                errorGeolocation: 'æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒåœ°ç†å®šä½',
                errorPermissionDenied: 'ä½ç½®è®¿é—®è¢«æ‹’ç»ã€‚è¯·åœ¨æµè§ˆå™¨ä¸­å…è®¸è®¿é—®',
                errorUnavailable: 'ä½ç½®ä¿¡æ¯ä¸å¯ç”¨',
                errorTimeout: 'è·å–ä½ç½®ä¿¡æ¯è¶…æ—¶ã€‚è¯·é‡è¯•',
                currentPressureTitle: 'å½“å‰æ°”å‹',
                statusHigh: 'ğŸ”º é«˜æ°”å‹',
                statusNormal: 'â¡ï¸ æ­£å¸¸æ°”å‹',
                statusLow: 'ğŸ”» ä½æ°”å‹',
                hourlyTitle: 'â° æ¯å°æ—¶é¢„æŠ¥ (24å°æ—¶)',
                dailyTitle: 'ğŸ“… æ¯æ—¥é¢„æŠ¥ (5å¤©)',
                today: 'ä»Šå¤©',
                tomorrow: 'æ˜å¤©',
                dayNames: ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'],
                pressureLabel: 'æ°”å‹',
            },
            es: {
                title: 'â›ˆï¸ PronÃ³stico de PresiÃ³n AtmosfÃ©rica',
                corsImportant: 'ğŸ’¡ <strong>Importante:</strong>',
                corsMessage: 'Si los datos no se cargan, por favor, visite',
                corsInstruction: 'y haga clic en "Request temporary access" antes de usar.',
                inputPlaceholder: 'Introduce el nombre de la ciudad (ej: Bangkok, London, Tokyo)',
                searchButton: 'ğŸ” Buscar',
                currentLocationButton: 'ğŸ“ UbicaciÃ³n Actual',
                aboutLink: 'Acerca de la aplicaciÃ³n',
                loading: 'Cargando datos...',
                errorNoLocation: 'Por favor, introduce el nombre de una ciudad',
                errorFetch: 'No se pudieron obtener los datos. Por favor, habilite el proxy CORS como se indica arriba.',
                errorNotFound: 'Ciudad no encontrada. Por favor, compruebe la ortografÃ­a.',
                errorGeolocation: 'Tu navegador no soporta la geolocalizaciÃ³n.',
                errorPermissionDenied: 'Acceso a la ubicaciÃ³n denegado. Por favor, permite el acceso en tu navegador.',
                errorUnavailable: 'La informaciÃ³n de ubicaciÃ³n no estÃ¡ disponible.',
                errorTimeout: 'Se agotÃ³ el tiempo de espera para obtener la ubicaciÃ³n.',
                currentPressureTitle: 'PresiÃ³n AtmosfÃ©rica Actual',
                statusHigh: 'ğŸ”º Alta PresiÃ³n',
                statusNormal: 'â¡ï¸ PresiÃ³n Normal',
                statusLow: 'ğŸ”» Baja PresiÃ³n',
                hourlyTitle: 'â° PronÃ³stico por hora (24h)',
                dailyTitle: 'ğŸ“… PronÃ³stico diario (5 dÃ­as)',
                today: 'Hoy',
                tomorrow: 'MaÃ±ana',
                dayNames: ['Dom', 'Lun', 'Mar', 'MiÃ©', 'Jue', 'Vie', 'SÃ¡b'],
                pressureLabel: 'PresiÃ³n',
            },
        };

        let currentLang = 'th';

        function applyLanguage(lang) {
            const data = langData[lang];
            if (!data) return;

            document.getElementById('app-title').textContent = data.title;
            document.getElementById('cors-important').innerHTML = data.corsImportant;
            document.getElementById('cors-message').textContent = data.corsMessage;
            document.getElementById('cors-instruction').textContent = data.corsInstruction;
            document.getElementById('locationInput').placeholder = data.inputPlaceholder;
            document.getElementById('search-button').textContent = data.searchButton;
            document.getElementById('current-location-button').textContent = data.currentLocationButton;
            document.getElementById('about-link').textContent = data.aboutLink;
            document.getElementById('loading').textContent = data.loading;
            document.getElementById('current-pressure-title').textContent = data.currentPressureTitle;
            document.getElementById('hourly-forecast-title').textContent = data.hourlyTitle;
            document.getElementById('daily-forecast-title').textContent = data.dailyTitle;

            // Update pressure status text
            const pressureStatusElement = document.getElementById('pressureStatus');
            if (pressureStatusElement.textContent) {
                const pressure = parseFloat(document.getElementById('currentPressure').textContent);
                if (!isNaN(pressure)) {
                    const status = getPressureStatus(pressure);
                    pressureStatusElement.textContent = data[status.text];
                }
            }
            
            // Update the HTML lang attribute
            document.documentElement.lang = lang;

            // Highlight the active language button
            document.querySelectorAll('.lang-button').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
        }

        function toggleDarkMode() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const isDarkMode = body.classList.contains('dark-mode');
            localStorage.setItem('darkMode', isDarkMode);
            document.getElementById('themeIcon').textContent = isDarkMode ? 'â˜€ï¸' : 'ğŸŒ™';
        }

        function loadThemeAndLang() {
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = 'â˜€ï¸';
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('themeIcon').textContent = 'ğŸŒ™';
            }

            const storedLang = localStorage.getItem('lang') || 'th';
            currentLang = storedLang;
            applyLanguage(currentLang);
        }

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('weatherData').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(messageKey) {
            const errorDiv = document.getElementById('error');
            const message = langData[currentLang][messageKey];
            errorDiv.innerHTML = `âŒ ${message}`;
            errorDiv.style.display = 'block';
            hideLoading();
        }

        function showWeatherData() {
            document.getElementById('weatherData').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            hideLoading();
        }

        function getPressureStatus(pressure) {
            if (pressure > 1020) return { text: 'statusHigh', class: 'status-good' };
            if (pressure < 1000) return { text: 'statusLow', class: 'status-danger' };
            return { text: 'statusNormal', class: 'status-warning' };
        }

        async function fetchWeatherData(lat, lon, cityName = '') {
            showLoading();
            
            try {
                let currentData, forecastData;
                const langCode = currentLang === 'zh' ? 'zh_cn' : currentLang; // Adjust for Chinese
                
                try {
                    const currentResponse = await fetch(
                        `${API_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${langCode}`
                    );
                    const forecastResponse = await fetch(
                        `${API_BASE}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${langCode}`
                    );
                    
                    if (currentResponse.ok && forecastResponse.ok) {
                        currentData = await currentResponse.json();
                        forecastData = await forecastResponse.json();
                    } else {
                        throw new Error('Direct API failed');
                    }
                } catch (directError) {
                    console.log('Using CORS proxy...');
                    const currentResponse = await fetch(
                        `${CORS_PROXY}${API_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${langCode}`
                    );
                    const forecastResponse = await fetch(
                        `${CORS_PROXY}${API_BASE}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=${langCode}`
                    );

                    if (!currentResponse.ok || !forecastResponse.ok) {
                        throw new Error('CORS_ERROR');
                    }

                    currentData = await currentResponse.json();
                    forecastData = await forecastResponse.json();
                }

                displayCurrentWeather(currentData);
                displayHourlyForecast(forecastData.list.slice(0, 8));
                displayDailyForecast(forecastData.list);
                
                showWeatherData();
            } catch (error) {
                if (error.message === 'CORS_ERROR') {
                    showError('errorFetch');
                } else {
                    showError('errorNotFound');
                }
            }
        }

        function displayCurrentWeather(data) {
            document.getElementById('currentLocation').textContent = 
                `ğŸ“ ${data.name}, ${data.sys.country}`;
            document.getElementById('currentPressure').textContent = 
                Math.round(data.main.pressure);
            document.getElementById('currentTemp').textContent = 
                Math.round(data.main.temp);
            document.getElementById('currentHumidity').textContent = 
                data.main.humidity;
            document.getElementById('currentWind').textContent = 
                Math.round(data.wind?.speed * 3.6 || 0);

            const status = getPressureStatus(data.main.pressure);
            const statusElement = document.getElementById('pressureStatus');
            statusElement.textContent = langData[currentLang][status.text];
            statusElement.className = status.class;
        }

        function displayHourlyForecast(hourlyData) {
            const container = document.getElementById('hourlyForecast');
            container.innerHTML = '';

            hourlyData.forEach((hour, index) => {
                const time = new Date(hour.dt * 1000);
                const timeStr = time.getHours().toString().padStart(2, '0') + ':00';
                
                const hourItem = document.createElement('div');
                hourItem.className = 'hourly-item';
                hourItem.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">${timeStr}</div>
                    <div style="font-size: 1.5em; margin: 5px 0;">${getWeatherIcon(hour.weather[0].icon)}</div>
                    <div style="margin: 8px 0; font-size: 1.2em; font-weight: bold;">
                        ${Math.round(hour.main.pressure)} hPa
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${Math.round(hour.main.temp)}Â°C
                    </div>
                `;
                container.appendChild(hourItem);
            });
        }

        function displayDailyForecast(forecastData) {
            const container = document.getElementById('dailyForecast');
            container.innerHTML = '';

            const dailyData = {};
            forecastData.forEach(item => {
                const date = new Date(item.dt * 1000);
                const dateKey = date.toDateString();
                
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = {
                        date: date,
                        pressures: [],
                        temps: [],
                        icons: []
                    };
                }
                
                dailyData[dateKey].pressures.push(item.main.pressure);
                dailyData[dateKey].temps.push(item.main.temp);
                dailyData[dateKey].icons.push(item.weather[0].icon);
            });

            const days = Object.values(dailyData).slice(0, 5);
            const dayNames = langData[currentLang].dayNames;
            
            days.forEach((day, index) => {
                let dayName;
                if (currentLang === 'th') {
                    dayName = index === 0 ? 'à¸§à¸±à¸™à¸™à¸µà¹‰' : 
                              index === 1 ? 'à¸à¸£à¸¸à¹ˆà¸‡à¸™à¸µà¹‰' : 
                              dayNames[day.date.getDay()];
                } else if (currentLang === 'en') {
                    dayName = index === 0 ? 'Today' : 
                              index === 1 ? 'Tomorrow' : 
                              dayNames[day.date.getDay()];
                } else if (currentLang === 'ja') {
                    dayName = index === 0 ? 'ä»Šæ—¥' : 
                              index === 1 ? 'æ˜æ—¥' : 
                              dayNames[day.date.getDay()];
                } else if (currentLang === 'zh') {
                    dayName = index === 0 ? 'ä»Šå¤©' : 
                              index === 1 ? 'æ˜å¤©' : 
                              dayNames[day.date.getDay()];
                } else if (currentLang === 'es') {
                    dayName = index === 0 ? 'Hoy' : 
                              index === 1 ? 'MaÃ±ana' : 
                              dayNames[day.date.getDay()];
                }
                
                const maxPressure = Math.max(...day.pressures);
                const minPressure = Math.min(...day.pressures);
                const maxTemp = Math.max(...day.temps);
                const minTemp = Math.min(...day.temps);
                
                const iconCounts = day.icons.reduce((acc, icon) => {
                    acc[icon] = (acc[icon] || 0) + 1;
                    return acc;
                }, {});
                const mostCommonIcon = Object.keys(iconCounts).reduce((a, b) => iconCounts[a] > iconCounts[b] ? a : b, day.icons[0]);

                const dailyItem = document.createElement('div');
                dailyItem.className = 'daily-item';
                dailyItem.innerHTML = `
                    <div class="day-name">${dayName}</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px; opacity: 0.8;">
                        ${day.date.getDate()}/${day.date.getMonth() + 1}
                    </div>
                    <div style="font-size: 1.8em; margin: 8px 0;">
                        ${getWeatherIcon(mostCommonIcon)}
                    </div>
                    <div style="margin: 8px 0;">
                        <strong>${langData[currentLang].pressureLabel}</strong>
                        <div class="high-low">
                            <span class="high-pressure">â†‘${Math.round(maxPressure)}</span>
                            <span class="low-pressure">â†“${Math.round(minPressure)}</span>
                        </div>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ğŸŒ¡ï¸ ${Math.round(minTemp)}Â° - ${Math.round(maxTemp)}Â°C
                    </div>
                `;
                container.appendChild(dailyItem);
            });
        }

        function getWeatherIcon(iconCode) {
            const iconMap = {
                '01d': 'â˜€ï¸', '01n': 'ğŸŒ™',
                '02d': 'â›…', '02n': 'â˜ï¸',
                '03d': 'â˜ï¸', '03n': 'â˜ï¸',
                '04d': 'â˜ï¸', '04n': 'â˜ï¸',
                '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸',
                '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
                '11d': 'â›ˆï¸', '11n': 'â›ˆï¸',
                '13d': 'â„ï¸', '13n': 'â„ï¸',
                '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
            };
            return iconMap[iconCode] || 'ğŸŒ¤ï¸';
        }

        async function searchWeather() {
            const location = document.getElementById('locationInput').value.trim();
            if (!location) {
                showError('errorNoLocation');
                return;
            }

            showLoading();

            try {
                let response;
                
                try {
                    response = await fetch(
                        `${API_BASE}/weather?q=${location}&appid=${API_KEY}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('Direct API failed');
                    }
                } catch (directError) {
                    console.log('Using CORS proxy for search...');
                    response = await fetch(
                        `${CORS_PROXY}${API_BASE}/weather?q=${location}&appid=${API_KEY}`
                    );
                }

                if (!response.ok) {
                    throw new Error('NOT_FOUND');
                }

                const data = await response.json();
                await fetchWeatherData(data.coord.lat, data.coord.lon, location);
                document.getElementById('locationInput').value = '';
            } catch (error) {
                if (error.message === 'NOT_FOUND') {
                    showError('errorNotFound');
                } else {
                    showError('errorFetch');
                }
            }
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showError('errorGeolocation');
                return;
            }

            showLoading();

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    await fetchWeatherData(lat, lon);
                },
                (error) => {
                    let messageKey = 'errorGeolocation';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            messageKey = 'errorPermissionDenied';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            messageKey = 'errorUnavailable';
                            break;
                        case error.TIMEOUT:
                            messageKey = 'errorTimeout';
                            break;
                    }
                    showError(messageKey);
                }
            );
        }

        document.getElementById('locationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchWeather();
            }
        });

        document.querySelectorAll('.lang-button').forEach(button => {
            button.addEventListener('click', () => {
                currentLang = button.dataset.lang;
                localStorage.setItem('lang', currentLang);
                applyLanguage(currentLang);
                
                // Re-fetch weather data in new language if data is already displayed
                const weatherDataElement = document.getElementById('weatherData');
                if (weatherDataElement.style.display !== 'none' && !weatherDataElement.classList.contains('initial-load')) {
                    const lat = JSON.parse(localStorage.getItem('last-coords')).lat;
                    const lon = JSON.parse(localStorage.getItem('last-coords')).lon;
                    fetchWeatherData(lat, lon);
                }
            });
        });

        window.onload = () => {
            loadThemeAndLang(); // à¹€à¸£à¸µà¸¢à¸à¹ƒà¸Šà¹‰à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¹€à¸à¸·à¹ˆà¸­à¹‚à¸«à¸¥à¸”à¸˜à¸µà¸¡à¹à¸¥à¸°à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¹„à¸§à¹‰
            fetchWeatherData(13.7563, 100.5018, 'Bangkok');
        };
    </script>
</body>
</html>
