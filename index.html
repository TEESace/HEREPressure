<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏≠‡∏õ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f7f9; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß‡∏ô‡∏ß‡∏• */
            color: #333; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤‡πÄ‡∏Ç‡πâ‡∏° */
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #ffffff; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á container ‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß */
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1); /* ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏Å‡∏±‡∏ö‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Ç‡∏≤‡∏ß */
            border: 1px solid #e0e0e0;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            color: #333; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ */
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .cors-notice {
            margin: 10px 0;
            padding: 15px;
            background: rgba(255, 229, 100, 0.3); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® */
            border: 1px solid rgba(255, 193, 7, 0.4);
            border-radius: 10px;
            color: #555; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏® */
            font-size: 0.9em;
            text-align: center;
        }

        .cors-notice a {
            color: #d68910;
            text-decoration: none;
            font-weight: bold;
        }

        .cors-notice a:hover {
            text-decoration: underline;
        }

        .location-input {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .location-input input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 1px solid #ccc; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏™‡πâ‡∏ô‡∏Ç‡∏≠‡∏ö */
            border-radius: 10px;
            background: #ffffff; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
            color: #333; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ */
        }

        .location-input input::placeholder {
            color: #999;
        }

        .location-input button {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background: #3498db; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏∏‡πà‡∏° */
            color: white; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏∏‡πà‡∏° */
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .location-input button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .current-pressure {
            background: #f9f9f9; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡πà‡∏ß‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏•‡∏±‡∏Å */
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 30px;
            color: #333; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            border: 1px solid #eee;
        }

        .current-pressure h2 {
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .pressure-value {
            font-size: 3em;
            font-weight: bold;
            margin: 10px 0;
            color: #2c3e50;
        }

        .pressure-unit {
            font-size: 1.2em;
            opacity: 0.8;
        }

        .forecast-section {
            background: #ffffff;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            border: 1px solid #e9e9e9;
        }

        .forecast-section h3 {
            font-size: 1.5em;
            margin-bottom: 15px;
            text-align: center;
        }

        .hourly-forecast, .daily-forecast {
            display: grid;
            gap: 15px;
            margin-bottom: 10px;
        }

        .hourly-forecast {
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        }

        .daily-forecast {
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        }

        .hourly-item, .daily-item {
            background: #f9f9f9; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå */
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid #eee;
        }

        .hourly-item:hover, .daily-item:hover {
            transform: translateY(-5px);
            background: #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }

        .day-name {
            font-weight: bold;
            margin-bottom: 8px;
        }

        .high-low {
            display: flex;
            justify-content: space-around;
            margin-top: 5px;
        }

        .loading {
            text-align: center;
            color: #555; /* ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° loading */
            font-size: 1.2em;
            padding: 40px;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(0,0,0,0.1); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ß‡∏á‡∏Å‡∏•‡∏° loading */
            border-radius: 50%;
            border-top-color: #333; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ß‡∏á‡∏Å‡∏•‡∏° loading */
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(255, 0, 0, 0.1); /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á error */
            border: 1px solid rgba(255, 0, 0, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: #D8000C; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° error */
            text-align: center;
            margin: 10px 0;
        }

        .current-location {
            color: #555;
            text-align: center;
            margin-bottom: 10px;
        }

        .status-good { color: #27ae60; }
        .status-warning { color: #f39c12; }
        .status-danger { color: #c0392b; }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .header h1 {
                font-size: 2em;
            }
            .pressure-value {
                font-size: 2.5em;
            }
            .location-input {
                flex-direction: column;
            }
            .location-input input, .location-input button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õàÔ∏è ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</h1>
            
            <div class="cors-notice">
                üí° <strong>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç:</strong> ‡∏´‡∏≤‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà 
                <a href="https://cors-anywhere.herokuapp.com/corsdemo" target="_blank">cors-anywhere.herokuapp.com/corsdemo</a> 
                ‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "Request temporary access" ‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
            </div>
            
            <div class="location-input">
                <input type="text" id="locationInput" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á (‡πÄ‡∏ä‡πà‡∏ô Bangkok, London, Tokyo)">
                <button onclick="searchWeather()">üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</button>
                <button onclick="getCurrentLocation()">üìç ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</button>
            </div>
            <div class="current-location" id="currentLocation"></div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="weatherData" style="display: none;">
            <div class="current-pressure">
                <h2>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏® ‡∏ì ‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ</h2>
                <div class="pressure-value" id="currentPressure">-</div>
                <div class="pressure-unit">hPa</div>
                <div id="pressureStatus" style="margin-top: 10px; font-weight: bold;"></div>
                <div style="margin-top: 15px; opacity: 0.9; display: flex; justify-content: center; gap: 30px; flex-wrap: wrap;">
                    <div>üå°Ô∏è <span id="currentTemp">-</span>¬∞C</div>
                    <div>üíß <span id="currentHumidity">-</span>%</div>
                    <div>üí® <span id="currentWind">-</span> km/h</div>
                </div>
            </div>

            <div class="forecast-section">
                <h3>‚è∞ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á (24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)</h3>
                <div class="hourly-forecast" id="hourlyForecast"></div>
            </div>

            <div class="forecast-section">
                <h3>üìÖ ‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ì‡πå‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (5 ‡∏ß‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤)</h3>
                <div class="daily-forecast" id="dailyForecast"></div>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = '511d57e91a9ca60a44bd189d78dfe9af';
        const API_BASE = 'https://api.openweathermap.org/data/2.5';
        const CORS_PROXY = 'https://cors-anywhere.herokuapp.com/';

        function showLoading() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('weatherData').style.display = 'none';
            document.getElementById('error').style.display = 'none';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.innerHTML = `‚ùå ${message}`;
            errorDiv.style.display = 'block';
            hideLoading();
        }

        function showWeatherData() {
            document.getElementById('weatherData').style.display = 'block';
            document.getElementById('error').style.display = 'none';
            hideLoading();
        }

        function getPressureStatus(pressure) {
            if (pressure > 1020) return { text: 'üî∫ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏™‡∏π‡∏á', class: 'status-good' };
            if (pressure < 1000) return { text: 'üîª ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏ï‡πà‡∏≥', class: 'status-danger' };
            return { text: '‚û°Ô∏è ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏õ‡∏Å‡∏ï‡∏¥', class: 'status-warning' };
        }

        async function fetchWeatherData(lat, lon, cityName = '') {
            showLoading();
            
            try {
                let currentData, forecastData;
                
                try {
                    const currentResponse = await fetch(
                        `${API_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=th`
                    );
                    const forecastResponse = await fetch(
                        `${API_BASE}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=th`
                    );
                    
                    if (currentResponse.ok && forecastResponse.ok) {
                        currentData = await currentResponse.json();
                        forecastData = await forecastResponse.json();
                    } else {
                        throw new Error('Direct API failed');
                    }
                } catch (directError) {
                    console.log('‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ CORS proxy...');
                    const currentResponse = await fetch(
                        `${CORS_PROXY}${API_BASE}/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=th`
                    );
                    const forecastResponse = await fetch(
                        `${CORS_PROXY}${API_BASE}/forecast?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric&lang=th`
                    );

                    if (!currentResponse.ok || !forecastResponse.ok) {
                        throw new Error('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô CORS proxy ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô');
                    }

                    currentData = await currentResponse.json();
                    forecastData = await forecastResponse.json();
                }

                displayCurrentWeather(currentData);
                displayHourlyForecast(forecastData.list.slice(0, 8));
                displayDailyForecast(forecastData.list);
                
                showWeatherData();
            } catch (error) {
                showError(error.message);
            }
        }

        function displayCurrentWeather(data) {
            document.getElementById('currentLocation').textContent = 
                `üìç ${data.name}, ${data.sys.country}`;
            document.getElementById('currentPressure').textContent = 
                Math.round(data.main.pressure);
            document.getElementById('currentTemp').textContent = 
                Math.round(data.main.temp);
            document.getElementById('currentHumidity').textContent = 
                data.main.humidity;
            document.getElementById('currentWind').textContent = 
                Math.round(data.wind?.speed * 3.6 || 0);

            const status = getPressureStatus(data.main.pressure);
            const statusElement = document.getElementById('pressureStatus');
            statusElement.textContent = status.text;
            statusElement.className = status.class;
        }

        function displayHourlyForecast(hourlyData) {
            const container = document.getElementById('hourlyForecast');
            container.innerHTML = '';

            hourlyData.forEach((hour, index) => {
                const time = new Date(hour.dt * 1000);
                const timeStr = time.getHours().toString().padStart(2, '0') + ':00';
                
                const hourItem = document.createElement('div');
                hourItem.className = 'hourly-item';
                hourItem.innerHTML = `
                    <div style="font-weight: bold; margin-bottom: 5px;">${timeStr}</div>
                    <div style="font-size: 1.5em; margin: 5px 0;">${getWeatherIcon(hour.weather[0].icon)}</div>
                    <div style="margin: 8px 0; font-size: 1.2em; font-weight: bold;">
                        ${Math.round(hour.main.pressure)} hPa
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        ${Math.round(hour.main.temp)}¬∞C
                    </div>
                `;
                container.appendChild(hourItem);
            });
        }

        function displayDailyForecast(forecastData) {
            const container = document.getElementById('dailyForecast');
            container.innerHTML = '';

            const dailyData = {};
            forecastData.forEach(item => {
                const date = new Date(item.dt * 1000);
                const dateKey = date.toDateString();
                
                if (!dailyData[dateKey]) {
                    dailyData[dateKey] = {
                        date: date,
                        pressures: [],
                        temps: [],
                        icons: [],
                        items: []
                    };
                }
                
                dailyData[dateKey].pressures.push(item.main.pressure);
                dailyData[dateKey].temps.push(item.main.temp);
                dailyData[dateKey].icons.push(item.weather[0].icon);
                dailyData[dateKey].items.push(item);
            });

            const days = Object.values(dailyData).slice(0, 5);
            const dayNames = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'];
            
            days.forEach((day, index) => {
                const dayName = index === 0 ? '‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ' : 
                                index === 1 ? '‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ' : 
                                dayNames[day.date.getDay()];
                
                const maxPressure = Math.max(...day.pressures);
                const minPressure = Math.min(...day.pressures);
                const maxTemp = Math.max(...day.temps);
                const minTemp = Math.min(...day.temps);
                const mostCommonIcon = day.icons[0]; // ‡πÉ‡∏ä‡πâ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô
                
                const dailyItem = document.createElement('div');
                dailyItem.className = 'daily-item';
                dailyItem.innerHTML = `
                    <div class="day-name">${dayName}</div>
                    <div style="font-size: 0.9em; margin-bottom: 8px; opacity: 0.8;">
                        ${day.date.getDate()}/${day.date.getMonth() + 1}
                    </div>
                    <div style="font-size: 1.8em; margin: 8px 0;">
                        ${getWeatherIcon(mostCommonIcon)}
                    </div>
                    <div style="margin: 8px 0;">
                        <strong>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏®</strong>
                        <div class="high-low">
                            <span style="color: #c0392b;">‚Üë${Math.round(maxPressure)}</span>
                            <span style="color: #2980b9;">‚Üì${Math.round(minPressure)}</span>
                        </div>
                    </div>
                    <div style="font-size: 0.9em; opacity: 0.8;">
                        üå°Ô∏è ${Math.round(minTemp)}¬∞ - ${Math.round(maxTemp)}¬∞C
                    </div>
                `;
                container.appendChild(dailyItem);
            });
        }

        function getWeatherIcon(iconCode) {
            const iconMap = {
                '01d': '‚òÄÔ∏è', '01n': 'üåô',
                '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
                '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
                '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
                '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
                '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
                '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
            };
            return iconMap[iconCode] || 'üå§Ô∏è';
        }

        async function searchWeather() {
            const location = document.getElementById('locationInput').value.trim();
            if (!location) {
                showError('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á');
                return;
            }

            showLoading();

            try {
                let response;
                
                try {
                    response = await fetch(
                        `${API_BASE}/weather?q=${location}&appid=${API_KEY}`
                    );
                    
                    if (!response.ok) {
                        throw new Error('Direct API failed');
                    }
                } catch (directError) {
                    console.log('‡∏•‡∏≠‡∏á‡πÉ‡∏ä‡πâ CORS proxy ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...');
                    response = await fetch(
                        `${CORS_PROXY}${API_BASE}/weather?q=${location}&appid=${API_KEY}`
                    );
                }

                if (!response.ok) {
                    throw new Error('‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡∏∞‡∏Å‡∏î‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á');
                }

                const data = await response.json();
                await fetchWeatherData(data.coord.lat, data.coord.lon, location);
                document.getElementById('locationInput').value = '';
            } catch (error) {
                showError(error.message);
            }
        }

        function getCurrentLocation() {
            if (!navigator.geolocation) {
                showError('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
                return;
            }

            showLoading();

            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    await fetchWeatherData(lat, lon);
                },
                (error) => {
                    let message = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ';
                    switch(error.code) {
                        case error.PERMISSION_DENIED:
                            message = '‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÉ‡∏ô‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            message = '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
                            break;
                        case error.TIMEOUT:
                            message = '‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà';
                            break;
                    }
                    showError(message);
                }
            );
        }

        // Event listeners
        document.getElementById('locationInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchWeather();
            }
        });

        // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏°‡∏´‡∏≤‡∏ô‡∏Ñ‡∏£
        window.onload = () => {
            fetchWeatherData(13.7563, 100.5018, 'Bangkok');
        };
    </script>
</body>
</html>
